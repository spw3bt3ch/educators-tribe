{% extends "base.html" %}

{% block title %}Create Advertisement - Admin - Educators' Tribe{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white rounded-xl shadow-lg p-8">
        <div class="mb-6">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Create Advertisement (Free)</h2>
            <p class="text-gray-600">Create an advertisement that will be automatically approved and free for the selected user.</p>
        </div>
        
        <form action="{{ url_for('create_advert') }}" method="POST" enctype="multipart/form-data" class="space-y-6">
            <div>
                <label for="user_id" class="block text-sm font-medium text-gray-700 mb-2">Assign to User *</label>
                <select id="user_id" name="user_id" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">-- Select a user --</option>
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }} {% if user.full_name %}({{ user.full_name }}){% endif %}</option>
                    {% endfor %}
                </select>
                <p class="text-sm text-gray-500 mt-1">Select the user this advertisement will be assigned to</p>
            </div>
            
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Advert Title *</label>
                <input type="text" id="title" name="title" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="Enter your advertisement title">
            </div>
            
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea id="description" name="description" rows="4"
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Describe your advertisement"></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Advert Image *</label>
                <p class="text-xs text-gray-500 mb-3">Upload an image file or provide an image URL</p>
                
                <!-- Image Upload -->
                <div class="mb-3">
                    <label for="image_file" class="block text-sm text-gray-600 mb-2">Upload Image (PNG, JPG, JPEG, GIF, WEBP)</label>
                    <input type="file" 
                           id="image_file" 
                           name="image_file" 
                           accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
                           onchange="previewImageFromFile(event)"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                
                <!-- OR Divider -->
                <div class="flex items-center my-4">
                    <div class="flex-1 border-t border-gray-300"></div>
                    <span class="px-4 text-sm text-gray-500">OR</span>
                    <div class="flex-1 border-t border-gray-300"></div>
                </div>
                
                <!-- Image URL -->
                <div>
                    <label for="image_url" class="block text-sm text-gray-600 mb-2">Image URL</label>
                    <input type="url" id="image_url" name="image_url"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="https://example.com/image.jpg"
                           onchange="previewImageFromUrl(event)">
                    <p class="text-sm text-gray-500 mt-1">Provide a URL to an image hosted elsewhere</p>
                </div>
                
                <!-- Image Preview -->
                <div id="image-preview" class="mt-4 hidden">
                    <img id="preview-img" src="" alt="Preview" class="max-w-full h-48 object-cover rounded-lg border border-gray-300">
                </div>
            </div>
            
            <div>
                <label for="link_url" class="block text-sm font-medium text-gray-700 mb-2">Link URL</label>
                <input type="url" id="link_url" name="link_url"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="https://example.com">
                <p class="text-sm text-gray-500 mt-1">URL where users should be directed when they click the button</p>
            </div>
            
            <div>
                <label for="button_text" class="block text-sm font-medium text-gray-700 mb-2">Button Text</label>
                <input type="text" id="button_text" name="button_text" value="Learn More"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="Learn More">
            </div>
            
            <div>
                <label for="weeks" class="block text-sm font-medium text-gray-700 mb-2">Duration (Weeks) *</label>
                <input type="number" id="weeks" name="weeks" min="1" max="52" value="1" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                       placeholder="1">
                <p class="text-sm text-gray-500 mt-1">Select number of weeks to run this advertisement (1-52 weeks)</p>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p class="text-sm text-blue-800">
                    <strong>âœ“ Free Advertisement:</strong> This advertisement will be created for free and automatically activated for the selected duration. 
                    No payment required.
                </p>
            </div>
            
            <div class="flex space-x-4">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition">
                    Create Advertisement
                </button>
                <a href="{{ url_for('admin_adverts') }}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-8 py-3 rounded-lg font-semibold transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function previewImageFromUrl(event) {
    const url = event.target.value;
    const preview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    
    if (url) {
        previewImg.src = url;
        preview.classList.remove('hidden');
    } else {
        preview.classList.add('hidden');
    }
}

function previewImageFromFile(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    } else {
        preview.classList.add('hidden');
    }
}
</script>
{% endblock %}


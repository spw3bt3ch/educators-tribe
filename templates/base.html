<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Educators' Tribe{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Ensure navigation menu button is always clickable */
        #mobile-menu-button {
            position: relative;
            z-index: 1000 !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Ensure navigation bar stays above other content */
        nav {
            position: relative;
            z-index: 1000 !important;
        }
        
        /* Dropdown menu styling */
        .group:hover .group-hover\:visible {
            visibility: visible;
        }
        
        /* Keep dropdown open on hover and focus */
        .group:focus-within .group-hover\:visible {
            visibility: visible;
            opacity: 1;
        }
        
        /* Improve touch interaction for mobile dropdowns */
        @media (hover: none) and (pointer: coarse) {
            .group:active .group-hover\:visible {
                visibility: visible;
                opacity: 1;
            }
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-green-600 to-green-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('index') }}" class="flex items-center space-x-2">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 01.557 1.14l1.561 4.854a1 1 0 01-.404 1.2l-5 3a1 1 0 01-.784 0l-5-3a1 1 0 01-.404-1.2l1.56-4.854a1 1 0 01.558-1.14l1.94-.83-.624-1.624a1 1 0 01-.356-.257L2.606 6.08a1 1 0 010-1.84l7-3z"></path>
                        </svg>
                        <span class="text-white text-xl font-bold">Educators' Tribe</span>
                    </a>
                </div>
                
                <div class="hidden md:flex items-center space-x-2">
                    <a href="{{ url_for('index') }}" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition">Home</a>
                    <a href="{{ url_for('contact') }}" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition">Contact</a>
                    {% if current_user.is_authenticated %}
                        {% if current_user.__class__.__name__ == 'Admin' %}
                            <!-- Admin Menu -->
                            <div class="relative group">
                                <button type="button" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition flex items-center">
                                    Admin
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                    <a href="{{ url_for('admin_dashboard') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Dashboard</a>
                                    <a href="{{ url_for('admin_adverts') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Adverts</a>
                                </div>
                            </div>
                        {% else %}
                            <!-- Content Menu -->
                            <div class="relative group">
                                <button type="button" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition flex items-center">
                                    Content
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                    <a href="{{ url_for('create_post') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Write Post</a>
                                    {% if request.endpoint != 'index' %}<a href="{{ url_for('blog') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Blog</a>{% endif %}
                                    <a href="{{ url_for('news') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">News</a>
                                    <a href="{{ url_for('materials') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Materials</a>
                                </div>
                            </div>
                            <!-- Account Menu -->
                            <div class="relative group">
                                <button type="button" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition flex items-center">
                                    Account
                                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                    <a href="{{ url_for('profile') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Profile</a>
                                    <a href="{{ url_for('chat') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Chat</a>
                                    <div class="border-t border-gray-200 my-1"></div>
                                    <a href="{{ url_for('submit_advert') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">Submit Ad</a>
                                    <a href="{{ url_for('my_adverts') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700">My Adverts</a>
                                </div>
                            </div>
                        {% endif %}
                        <a href="{{ url_for('logout') }}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition">Logout</a>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="text-white hover:text-green-200 px-3 py-2 rounded-md text-sm font-medium transition">Login</a>
                        <a href="{{ url_for('register') }}" class="bg-white text-green-600 hover:bg-green-50 px-4 py-2 rounded-md text-sm font-medium transition">Register</a>
                    {% endif %}
                </div>
                
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white hover:text-green-200 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <div class="space-y-1">
                    <a href="{{ url_for('index') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition">Home</a>
                    <a href="{{ url_for('contact') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition">Contact</a>
                    {% if current_user.is_authenticated %}
                        {% if current_user.__class__.__name__ == 'Admin' %}
                            <div class="border-t border-green-500 my-2"></div>
                            <div class="px-3 py-2 text-xs font-semibold text-green-200 uppercase tracking-wider">Admin</div>
                            <a href="{{ url_for('admin_dashboard') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Dashboard</a>
                            <a href="{{ url_for('admin_adverts') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Adverts</a>
                        {% else %}
                            <div class="border-t border-green-500 my-2"></div>
                            <div class="px-3 py-2 text-xs font-semibold text-green-200 uppercase tracking-wider">Content</div>
                            <a href="{{ url_for('create_post') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Write Post</a>
                            {% if request.endpoint != 'index' %}<a href="{{ url_for('blog') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Blog</a>{% endif %}
                            <a href="{{ url_for('news') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">News</a>
                            <a href="{{ url_for('materials') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Materials</a>
                            <div class="border-t border-green-500 my-2"></div>
                            <div class="px-3 py-2 text-xs font-semibold text-green-200 uppercase tracking-wider">Account</div>
                            <a href="{{ url_for('profile') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Profile</a>
                            <a href="{{ url_for('chat') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Chat</a>
                            <div class="border-t border-green-500 my-2"></div>
                            <div class="px-3 py-2 text-xs font-semibold text-green-200 uppercase tracking-wider">Adverts</div>
                            <a href="{{ url_for('submit_advert') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">Submit Ad</a>
                            <a href="{{ url_for('my_adverts') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition pl-6">My Adverts</a>
                        {% endif %}
                        <div class="border-t border-green-500 my-2"></div>
                        <a href="{{ url_for('logout') }}" class="block bg-green-600 hover:bg-green-700 text-white px-3 py-2.5 rounded-md text-base font-medium mt-2 shadow-md">Logout</a>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="block text-white hover:text-green-200 hover:bg-green-700 px-3 py-2.5 rounded-md text-base font-medium transition">Login</a>
                        <a href="{{ url_for('register') }}" class="block bg-white text-green-600 hover:bg-green-50 px-3 py-2.5 rounded-md text-base font-medium mt-2 shadow-md">Register</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} bg-{{ 'green' if category == 'success' else 'red' if category == 'danger' else 'green' }}-100 border border-{{ 'green' if category == 'success' else 'red' if category == 'danger' else 'green' }}-400 text-{{ 'green' if category == 'success' else 'red' if category == 'danger' else 'green' }}-700 px-4 py-3 rounded relative mb-4" role="alert">
                        <span class="block sm:inline">{{ message }}</span>
                        <span class="absolute top-0 bottom-0 right-0 px-4 py-3">
                            <svg class="fill-current h-6 w-6 text-{{ 'green' if category == 'success' else 'red' if category == 'danger' else 'green' }}-500" role="button" onclick="this.parentElement.parentElement.remove()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                <path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/>
                            </svg>
                        </span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-base sm:text-lg font-semibold mb-4">About Us</h3>
                    <p class="text-sm sm:text-base text-gray-300">A platform for Nigerian teachers to share knowledge, stay updated with education news, and connect with the teaching community.</p>
                </div>
                <div>
                    <h3 class="text-base sm:text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="{{ url_for('index') }}" class="hover:text-white transition">Home</a></li>
                        <li><a href="{{ url_for('news') }}" class="hover:text-white transition">Education News</a></li>
                        {% if not current_user.is_authenticated %}
                            <li><a href="{{ url_for('register') }}" class="hover:text-white transition">Register</a></li>
                            <li><a href="{{ url_for('login') }}" class="hover:text-white transition">Login</a></li>
                        {% endif %}
                    </ul>
                </div>
                <div>
                    <h3 class="text-base sm:text-lg font-semibold mb-4">Contact</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="{{ url_for('contact') }}" class="hover:text-white transition">Contact Support</a></li>
                        <li><a href="mailto:ttribetechsupport@gmail.com" class="hover:text-white transition">ttribetechsupport@gmail.com</a></li>
                        <li><a href="tel:07077705842" class="hover:text-white transition">07077705842</a></li>
                        <li><a href="https://wa.me/2347077705842" target="_blank" rel="noopener noreferrer" class="hover:text-white transition">WhatsApp: 07077705842</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8">
                <div class="text-center">
                    <p class="text-gray-300">&copy; 2025 Educators' Tribe. All rights reserved.</p>
                    <p class="mt-2 text-sm text-gray-300">Developed by SMI Solutions</p>
                    <div class="mt-4">
                        <a href="{{ url_for('donate') }}"
                           class="inline-flex items-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white px-4 sm:px-6 py-2 rounded-lg font-semibold transition shadow-md hover:shadow-lg active:scale-95">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"></path>
                                <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                            â˜• Support This Growth
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle - ensure it works on all pages
        function initMobileMenu() {
            const menuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (menuButton && mobileMenu) {
                // Remove any existing listeners by cloning the button
                var newButton = menuButton.cloneNode(true);
                menuButton.parentNode.replaceChild(newButton, menuButton);
                
                // Attach click handler
                newButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Navigation menu button clicked');
                    mobileMenu.classList.toggle('hidden');
                }, false);
                
                // Also add touchstart for mobile
                newButton.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Navigation menu button touched');
                    mobileMenu.classList.toggle('hidden');
                }, false);
                
                console.log('Navigation menu initialized');
            } else {
                console.error('Navigation menu button or menu not found');
            }
        }
        
        // Desktop dropdown menu toggle for touch devices
        function initDropdownMenus() {
            // Only initialize on desktop (not mobile menu)
            if (window.innerWidth >= 768) {
                const dropdownGroups = document.querySelectorAll('nav .group');
                
                dropdownGroups.forEach(function(group) {
                    const button = group.querySelector('button');
                    const dropdown = group.querySelector('.absolute');
                    
                    if (button && dropdown) {
                        // Toggle dropdown on click (for touch devices)
                        button.addEventListener('click', function(e) {
                            // Check if it's a touch device
                            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                                e.preventDefault();
                                e.stopPropagation();
                                
                                // Close other dropdowns
                                dropdownGroups.forEach(function(otherGroup) {
                                    if (otherGroup !== group) {
                                        const otherDropdown = otherGroup.querySelector('.absolute');
                                        if (otherDropdown) {
                                            otherDropdown.classList.add('opacity-0', 'invisible');
                                        }
                                    }
                                });
                                
                                // Toggle current dropdown
                                dropdown.classList.toggle('opacity-0');
                                dropdown.classList.toggle('invisible');
                            }
                        });
                    }
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('nav .group')) {
                        dropdownGroups.forEach(function(group) {
                            const dropdown = group.querySelector('.absolute');
                            if (dropdown) {
                                dropdown.classList.add('opacity-0', 'invisible');
                            }
                        });
                    }
                });
            }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initMobileMenu();
                initDropdownMenus();
            });
        } else {
            // DOM already loaded
            setTimeout(function() {
                initMobileMenu();
                initDropdownMenus();
            }, 100);
        }
        
        // Also try to initialize after a short delay in case scripts load in different order
        setTimeout(function() {
            initMobileMenu();
            initDropdownMenus();
        }, 500);
        
        // Reinitialize dropdowns on window resize
        window.addEventListener('resize', function() {
            initDropdownMenus();
        });

        // Initialize Socket.IO (only if not already initialized by chat page)
        if (typeof io !== 'undefined' && !window.socketInitialized) {
            try {
                const socket = io();
                socket.on('connect', function() {
                    console.log('Connected to server');
                });
                window.socketInitialized = true;
            } catch (error) {
                console.error('Error initializing Socket.IO in base template:', error);
            }
        }
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>

